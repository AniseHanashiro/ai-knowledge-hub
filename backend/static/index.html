<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>AI Knowledge Hub</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="navbar">
        <div style="font-size: 1.2rem; font-weight: bold;">ğŸ§  AI Knowledge Hub</div>
        <div class="nav-links">
            <a href="/index.html" class="active">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="/timeline.html">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</a>
            <a href="/search.html">AIæ¤œç´¢</a>
            <a href="/following.html">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</a>
            <a href="/clips.html">ã‚¯ãƒªãƒƒãƒ—</a>
        </div>
        <button class="btn-collect" onclick="runCollect()">ğŸ”„ åé›†å®Ÿè¡Œ</button>
    </div>

    <div class="container">
        <div class="sidebar">
            <h3>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
            <div class="form-group">
                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                <select id="filter-category" onchange="loadArticles()">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="LLM">LLM</option>
                    <option value="ç”»åƒç”Ÿæˆ">ç”»åƒç”Ÿæˆ</option>
                    <option value="ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</option>
                    <option value="é–‹ç™ºãƒ„ãƒ¼ãƒ«">é–‹ç™ºãƒ„ãƒ¼ãƒ«</option>
                    <option value="ç ”ç©¶">ç ”ç©¶</option>
                    <option value="ãƒ“ã‚¸ãƒã‚¹">ãƒ“ã‚¸ãƒã‚¹</option>
                </select>
            </div>
            <div class="form-group">
                <label>å„ªå…ˆåº¦</label>
                <select id="filter-priority" onchange="loadArticles()">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="BREAKING">BREAKING</option>
                    <option value="HOT">HOT</option>
                    <option value="HIGH">HIGH</option>
                    <option value="MEDIUM">MEDIUM</option>
                    <option value="LOW">LOW</option>
                </select>
            </div>
            <div class="form-group">
                <label>ã‚½ãƒ¼ã‚¹ç¨®åˆ¥</label>
                <select id="filter-source" onchange="loadArticles()">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="rss">RSS/è¨˜äº‹</option>
                    <option value="youtube">YouTube</option>
                </select>
            </div>
            <div class="form-group">
                <label>æœŸé–“</label>
                <select id="filter-days" onchange="loadArticles()">
                    <option value="1">24æ™‚é–“ä»¥å†…</option>
                    <option value="3">3æ—¥ä»¥å†…</option>
                    <option value="7" selected>7æ—¥ä»¥å†…</option>
                    <option value="30">30æ—¥ä»¥å†…</option>
                </select>
            </div>
        </div>
        <div class="main-content">
            <div class="stats-bar" id="stats-container">
                <!-- Stats here -->
            </div>
            <div class="card-grid" id="articles-container">
                <!-- Articles here -->
            </div>
        </div>
    </div>

    <script>
        async function loadStats() {
            const res = await fetch('/api/stats');
            const stats = await res.json();
            document.getElementById('stats-container').innerHTML = `
        <div class="stat-item"><span class="stat-value">${stats.articles}</span><span class="stat-label">Total Articles</span></div>
        <div class="stat-item"><span class="stat-value">${stats.sources}</span><span class="stat-label">Active Sources</span></div>
    `;
        }

        async function loadArticles() {
            const cat = document.getElementById('filter-category').value;
            const pri = document.getElementById('filter-priority').value;
            const src = document.getElementById('filter-source').value;
            const days = document.getElementById('filter-days').value;

            let url = `/api/articles?days=${days}`;
            if (cat) url += `&category=${cat}`;
            if (pri) url += `&priority=${pri}`;
            if (src) url += `&source_type=${src}`;

            const res = await fetch(url);
            const articles = await res.json();

            const container = document.getElementById('articles-container');
            container.innerHTML = articles.map(a => `
        <div class="card">
            <div>
                <span class="badge badge-${a.priority_label}">${a.priority_label}</span>
                <span class="badge" style="background:var(--bg3); border:1px solid var(--border)">${a.category}</span>
            </div>
            <a href="${a.url}" target="_blank" class="card-title">${a.title}</a>
            <div class="card-summary">${a.summary_ja}</div>
            ${a.business_point ? `<div class="business-point">ğŸ’¼ ${a.business_point}</div>` : ''}
            <div class="card-tags">
                ${(a.tags || []).map(t => `<span class="tag">${t}</span>`).join('')}
            </div>
            <div class="card-footer">
                <div>Score: ${a.score} | <span class="trust-${a.trust_level}">Trust: ${a.trust_level}</span></div>
                <button class="clip-btn ${a.is_clipped ? 'clipped' : ''}" onclick="toggleClip(${a.id}, this)">
                  ${a.is_clipped ? 'â˜…' : 'â˜†'}
                </button>
            </div>
        </div>
    `).join('');
        }

        async function toggleClip(id, btn) {
            const isClipped = btn.classList.contains('clipped');
            if (isClipped) {
                await fetch(`/api/articles/${id}/clip`, { method: 'DELETE' });
                btn.classList.remove('clipped');
                btn.innerText = 'â˜†';
            } else {
                await fetch(`/api/articles/${id}/clip`, { method: 'POST' });
                btn.classList.add('clipped');
                btn.innerText = 'â˜…';
            }
        }

        async function runCollect() {
            alert("ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§åé›†ã‚’é–‹å§‹ã—ã¾ã™ã€‚");
            await fetch('/api/collect', { method: 'POST' });
        }

        window.onload = () => {
            loadStats();
            loadArticles();
        };
    </script>
</body>

</html>