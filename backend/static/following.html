<!DOCTYPE html>
<html lang="ja" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Following - AI Knowledge Hub</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .source-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .source-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }

        .source-card.disabled {
            opacity: 0.6;
        }

        .source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .add-source-form {
            background: var(--bg-secondary);
            border: 1px dashed var(--border-color);
            padding: 24px;
            border-radius: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-end;
            margin-bottom: 32px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .form-input {
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            color: var(--text-primary);
            padding: 10px 12px;
            border-radius: 6px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="brand">
            <span class="brand-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                    </path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
            </span>
            AI Hub
            <div class="nav-links">
                <a href="/index.html">ãƒ–ãƒ©ã‚¦ã‚º</a>
                <a href="/timeline.html">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</a>
                <a href="/search.html">æ¤œç´¢</a>
                <a href="/following.html" class="active">ãƒ•ã‚©ãƒ­ãƒ¼</a>
                <a href="/clips.html">ã‚¯ãƒªãƒƒãƒ—</a>
            </div>
        </div>
    </nav>

    <div class="container" style="display: block; max-width: 1000px;">
        <h2 style="margin-bottom: 24px;">ãƒ•ã‚©ãƒ­ãƒ¼ç®¡ç†</h2>

        <div class="add-source-form">
            <div class="form-group" style="flex: 2;">
                <label>URL (YouTube / RSS)</label>
                <input type="text" id="newUrl" class="form-input" placeholder="https://..." onblur="detectSource()">
            </div>
            <div class="form-group">
                <label>åå‰ (è‡ªå‹•)</label>
                <input type="text" id="newName" class="form-input">
            </div>
            <div class="form-group">
                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                <select id="newCat" class="form-input">
                    <option value="ä¼æ¥­ãƒˆãƒ©ãƒƒã‚«ãƒ¼">ä¼æ¥­ãƒˆãƒ©ãƒƒã‚«ãƒ¼</option>
                    <option value="ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ­ãƒ¼ãƒ³ãƒ" selected>ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ­ãƒ¼ãƒ³ãƒ</option>
                    <option value="AIæ´»ç”¨ãƒãƒƒã‚¯">AIæ´»ç”¨ãƒãƒƒã‚¯</option>
                    <option value="æŠ€è¡“ãƒ»ç ”ç©¶">æŠ€è¡“ãƒ»ç ”ç©¶</option>
                    <option value="ç¤¾ä¼šãƒ»å€«ç†ãƒ»æ”¿ç­–">ç¤¾ä¼šãƒ»å€«ç†ãƒ»æ”¿ç­–</option>
                    <option value="ãƒ“ã‚¸ãƒã‚¹ãƒ»æŠ•è³‡">ãƒ“ã‚¸ãƒã‚¹ãƒ»æŠ•è³‡</option>
                    <option value="é›‘å¤šãƒ»ã‚³ãƒ©ãƒ ">é›‘å¤šãƒ»ã‚³ãƒ©ãƒ </option>
                </select>
            </div>
            <div class="form-group" style="flex: 0;">
                <button class="collect-btn" onclick="addSource()">è¿½åŠ </button>
            </div>
        </div>

        <div class="source-grid" id="sourceGrid">
            <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted);">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script>
        let currentType = 'rss';

        async function detectSource() {
            const url = document.getElementById('newUrl').value.trim();
            if (!url) return;
            const res = await apiCall('/sources/detect', {
                method: 'POST',
                body: JSON.stringify({ url })
            });
            if (res) {
                currentType = res.type;
                if (!document.getElementById('newName').value) {
                    document.getElementById('newName').value = res.display_name;
                }
                document.getElementById('newCat').value = res.suggested_category;
            }
        }

        async function addSource() {
            const url = document.getElementById('newUrl').value.trim();
            const name = document.getElementById('newName').value.trim();
            const cat = document.getElementById('newCat').value;

            if (!url || !name) return alert('URLã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const res = await apiCall('/sources', {
                method: 'POST',
                body: JSON.stringify({
                    url: url,
                    display_name: name,
                    category: cat,
                    type: currentType
                })
            });

            if (res) {
                document.getElementById('newUrl').value = '';
                document.getElementById('newName').value = '';
                loadSources();
            }
        }

        async function toggleSource(id) {
            await apiCall(`/sources/${id}`, { method: 'PUT' });
            loadSources();
        }

        async function deleteSource(id) {
            if (confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                await apiCall(`/sources/${id}`, { method: 'DELETE' });
                loadSources();
            }
        }

        async function loadSources() {
            const data = await apiCall('/sources');
            const grid = document.getElementById('sourceGrid');
            if (!data) return;
            grid.innerHTML = '';

            data.forEach(s => {
                grid.innerHTML += `
                    <div class="source-card ${s.enabled === 0 ? 'disabled' : ''}">
                        <div class="source-header">
                            <span class="badge" style="background:var(--accent-light); color:var(--accent);">${s.type}</span>
                            <div style="display:flex; gap:8px;">
                                <button class="action-btn" onclick="toggleSource(${s.id})" title="${s.enabled === 1 ? 'ç„¡åŠ¹ã«ã™ã‚‹' : 'æœ‰åŠ¹ã«ã™ã‚‹'}">${s.enabled === 1 ? 'â¸ï¸' : 'â–¶ï¸'}</button>
                                <button class="action-btn" onclick="deleteSource(${s.id})" style="color:var(--breaking);">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <h4 style="margin-bottom:4px;">${s.display_name}</h4>
                        <div style="font-size:0.8rem; color:var(--text-muted); word-break:break-all; margin-bottom:12px;">${s.url}</div>
                        <div style="font-size:0.8rem; color:var(--text-secondary);">ã‚«ãƒ†ã‚´ãƒª: ${s.category}</div>
                    </div>
                `;
            });
        }

        document.addEventListener('DOMContentLoaded', loadSources);
    </script>
</body>

</html>