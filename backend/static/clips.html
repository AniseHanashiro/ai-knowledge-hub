<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>Clips - AI Knowledge Hub</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="navbar">
        <div style="font-size: 1.2rem; font-weight: bold;">ğŸ§  AI Knowledge Hub</div>
        <div class="nav-links">
            <a href="/index.html">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="/timeline.html">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</a>
            <a href="/search.html">AIæ¤œç´¢</a>
            <a href="/following.html">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</a>
            <a href="/clips.html" class="active">ã‚¯ãƒªãƒƒãƒ—</a>
        </div>
        <button class="btn-collect" onclick="runCollect()">ğŸ”„ åé›†å®Ÿè¡Œ</button>
    </div>

    <div class="container" style="flex-direction: column;">
        <h2>ğŸ“Œ ä¿å­˜ã—ãŸã‚¯ãƒªãƒƒãƒ—</h2>
        <div id="clips-content">
            <!-- clips here -->
        </div>
    </div>

    <script>
        async function loadClips() {
            const res = await fetch('/api/clips');
            const data = await res.json();

            const container = document.getElementById('clips-content');
            if (Object.keys(data).length === 0) {
                container.innerHTML = '<p>ä¿å­˜ã•ã‚ŒãŸã‚¯ãƒªãƒƒãƒ—ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®â˜†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚</p>';
                return;
            }

            let html = '';
            for (const folder in data) {
                html += `<h3 style="margin-top:2rem; padding-bottom:0.5rem; border-bottom:1px solid var(--border)">ğŸ“ ${folder}</h3>`;
                html += `<div class="card-grid">`;
                html += data[folder].map(a => `
            <div class="card">
                <div><span class="badge badge-MEDIUM">${a.source_name}</span></div>
                <a href="${a.url}" target="_blank" class="card-title">${a.title}</a>
                <div class="card-summary">${a.summary_ja}</div>
                <div class="card-footer" style="justify-content:flex-end">
                    <button class="btn-secondary" onclick="unclip(${a.id})">ã‚¯ãƒªãƒƒãƒ—è§£é™¤</button>
                </div>
            </div>
        `).join('');
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        async function unclip(id) {
            if (!confirm("ã‚¯ãƒªãƒƒãƒ—ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
            await fetch(`/api/articles/${id}/clip`, { method: 'DELETE' });
            loadClips();
        }

        async function runCollect() {
            alert("ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§åé›†ã‚’é–‹å§‹ã—ã¾ã™ã€‚");
            await fetch('/api/collect', { method: 'POST' });
        }

        window.onload = loadClips;
    </script>
</body>

</html>